8/27/2021

Aditi Dutta

CS specialization Bioinformatics
Scripps Research Institute - tRNA synthetases
Survival analysis, mutation callers and pathogenic significance. 
On campus, in-person

Lukas' introduction
 Intro to brain tumors, current standard of care
 Lab's role, collaborations with physicians and other labs
 
Papers
 AmpliconArchitect paper
 KidsFirst environment
 Kim et al.
 Instructions to create accounts on KidsFirst, Expanse.
 
9/13/2021
 
Budget estimated

I have identified 1227 patients that fit our analysis criteria, in addition to the 4,000 arriving in January 2022. 
1.1 biopsies per patient is 5,779 tumors. Cavatica tells me we have been charged $50 for the medulloblastoma project 
of 500 samples, but we’d like to use paired normal tissue where available as well, so let’s say $0.15 per AA run. 
This brings our estimated costs to $900. 
Attached is an excel sheet with the patient IDs and clinical metadata of the patient tumors we would like access to.
Thank you for keeping track of this Lukas!


9/29/2021

Apply for access to these repositories

Kids First: Familial Leukemia
Kids First: Neuroblastoma
Kids First: Myeloid Malignancies
Pediatric Brain Tumor Atlas: CBTTC
Pediatric Brain Tumor Atlas: PNOC
TARGET: Neuroblastoma
TARGET: Acute Myeloid Leukemia


1. Need a eRA Commons ID.
	Need to ask an administrative officer (AO), account administrator (AA), or signing official (SO)
	Contact "office of sponsored research"

Studies and access page https://www.notion.so/Studies-and-Access-a5d2f55a8b40461eac5bf32d9483e90f

#################################################
Hi Lukas,

This morning Aditi and I are trying to get project access for the pan-cancer ecDNA project to a few 
datasets on KidsFirst. Unfortunately we are well out of our depth. It looks like you already have an 
ongoing DUA with CBTN entitled "Pediatric Pan-Cancer Analysis of Structural Variants."    
Here's what we think we need:

1) Aditi has just asked UCSD to create an eRA Commons account for her. Do we need to link her eRA 
Commons account, when it is created, to the CBTN DUA?

2) KidsFirst has a number of pediatric tumors we can use outside of CBTN. The following KF studies 
have pediatric tumor WGS:
Kids First: Familial Leukemia
Kids First: Neuroblastoma
Kids First: Myeloid Malignancies
Pediatric Brain Tumor Atlas: CBTTC
Pediatric Brain Tumor Atlas: PNOC
Currently, we have access only to the CBTTC set. According to the KidsFirst Studies and Access page, 
the access to the KF studies is managed by dbGaP, and PNOC through the CBTN. I have already copied 
the authorized CBTTC files into our pan-cancer project; however, we will need to apply for DUAs to 
the other four sets (see link above) to analyze these 500 tumors.

3) The TARGET and HCMI (human cancer models initiative) datasets are not available on KidsFirst, but 
we may want to analyze them at some point in the future. Access control appears to be through dbGaP 
and download through SRA. No action required right now.

##########################################

10/15/2021

NB: Must import files from 
https://cavatica.sbgenomics.com/p/datasets#cavatica/sd-bhjxbdqk
not the kidsFirst portal, for Aditi to access them. No idea why.

10/18/2021

KidsFirst Intro talk
https://tinyurl.com/KF-Support
ASHG info session will post to YouTube @KidsFirstDRC channel

2/22/2022

Survival for KidsFirst

~2292 patients come up in my KidsFirst saved query. 
Survival data available for 1435 of these.


2/22/2022

Looking for St Jude survival data
https://platform.stjude.cloud/data/publications

Clinical cancer genomic profiling by three-platform sequencing of whole genome, whole exome and transcriptome
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6160438/
No

St. Jude Cloud—a Pediatric Cancer Genomic Data Sharing Ecosystem
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8102307/
No

THE GENOMIC LANDSCAPE OF HYPODIPLOID ACUTE LYMPHOBLASTIC LEUKEMIA
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3919793/
Yes, See supplementary table 3 for list of samples. Survival data exist but were not made available.

Whole-genome sequencing identifies genetic alterations in pediatric low-grade gliomas
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3727232/
No

C11orf95–RELA fusions drive oncogenic NF-κB signalling in ependymoma
https://www.nature.com/articles/nature13109#Sec25
No

Targeting Oxidative Stress in Embryonal Rhabdomyosarcoma
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3904731/
No; however I did see p53 mutation info in supplement

Assessing telomeric DNA content in pediatric cancers using whole-genome sequencing data
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3580411/
No

An inv(16)(p13.3q24.3)-encoded CBFA2T3-GLIS2 fusion protein defines an aggressive subtype of pediatric acute megakaryoblastic leukemia
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3547667/
Survival analysis but data not included in the paper

Novel mutations target distinct subgroups of medulloblastoma
https://pubmed.ncbi.nlm.nih.gov/22722829/
Yes, see suppl table 1

Hi all,
The FAQ for St Jude Cloud says:
We are working towards being able to provide additional clinical annotations such as treatment, 
 outcome, and survival data in the future. Unfortunately, we do not offer it today and we do not 
 have a timeline for when it will be available.
Clearly, we are not alone in wanting access to these data. 
I skimmed through a half-dozen publications coming out of the PCGP; a few do survival analysis 
 but do not publish the underlying data, and exactly one (Medulloblastoma) publishes the outcome data. 
I suggest we table this discussion for now. When our study is more mature, and we have ecDNA 
 data on the St Jude samples, maybe Jinghui will be able to tell us  how far they've gotten in 
 the above effort, and whether the data will become available during the lifetime of our project. 
Yours,
Owen

2/22/2022

Variant info for KidsFirst, St Jude

St Jude RTCG (PedPanCan_clinical): gVCF available.
St Jude (PedPanCancer ecDNA): gVCF, Somatic VCF available.


2/22/2022

Getting our cohort straight.

Our cohort is a mess. IDEK how many samples we can expect.

PNOC (KidsFirst): 65 biopsies. No data access yet. Will ping CBTN folks.
CBTN (KidsFirst): 922 biopsies. 

St Jude:
	Patients in both sets: 593
	Patients just in PedPanCancer ecDNA: 1047
	Patients just in PedPanCan_clinical: 247
	
	Biosamples in both sets: 1094
	Biosamples just in PedPanCancer ecDNA: 2055
	Biosamples just in PedPanCan_clinical: 538

3/3/2022 Addendum
Asking how many, what kind, and can we access additional samples from St Jude Cloud.
See notebooks/pancancer_ecdna/2022-02-23_sj_samples/st%20jude%20cohort.ipynb

NB. PedPanCan_clinical contains additional samples from RTCG. Because samples have been added since,
it is a subset of the data most recently available. I recommend we use the latest download from St Jude.

How many patients?
	Current cohort: 1483
	additional: 834
	Total cohort size: 2257

How many biosamples?
	Current cohort: 1539
	additional: 1004
	Total cohort size: 2543

What kinds of new samples did we get?

sample_type	current	latest	Total
Diagnosis	1446	777		2223
Relapse		72		88		160
Xenograft	0		109		109
Metastasis	21		7		28
Autopsy		0		23		23

What tumor types are represented among the new samples?
	Not going to type it, see nb. Lots of AML, RBL, WT, RMS.

What tumor types represented among the xenografts?

RBL      26
OS       22
RMS      18
NBL      13
..		 ..
Total	109

How many xenografts have associated patient tissue?
	99/109
	SJ000026 has 2 xenografts among 4 relapses (embryonal rhabdomyosarcoma, ERMS)
	SJ000911 has 2 xenografts for 2 diagnosis biopses (biological replicates?) (embyronal rhabdomyosarcoma, ERMS)

How many patients have germline sequencing?
	835

DISCUSSION
- Send list of all .bam files (tumor and normal) to Shanqing
- We have 109 xenografts!

3/1/2022

Accessing KF datasets

Still trying to gain access to datasets that aren't CBTN.

- Sent follow-up email requesting access to PNOC
- KF portal does not accurately reflect authorization privileges. "Analyze in CAVATICA" button will 
	return success message but not copy any files if you do not have access privilege.
	See https://forum.kidsfirstdrc.org/t/when-i-transfer-files-to-cavatica-the-portal-says-it-worked-but-the-files-dont-show-up/49
	and https://pgc-accounts.sbgenomics.com/account#dataset

Datsets we need access to:
Code	dbGaP	Study	N
KF-NBL	phs001436.v1.p1	Kids First: Neuroblastoma	354
KF-ED	phs001987.v1.p1	Kids First: Enchondromatoses	126
KF-CHDALL	phs002330.v1.p1	Kids First: Leukemia & Heart Defects in Down Syndrome	254
KF-OS	phs001714.v1.p1	Kids First: Osteosarcoma	93
TARGET-AML	phs000465.v21.p8	TARGET: Acute Myeloid Leukemia	55
TARGET-NB	phs000467.v21.p8	TARGET: Neuroblastoma	6
KF-FALL	phs001738.v1.p1	Kids First: Familial Leukemia	14
Total 902

PBTA-CBTN
PBTA-PNOC

TP53 database
https://tp53.isb-cgc.org/

- TP53 mutation by tumor tissue
- TP53 mutation distribution by codon

See also Understanding the function–structure and function–mutation relationships of p53 tumor suppressor protein by high-resolution missense mutation analysis
https://doi.org/10.1073/pnas.1431692100

Questions:
- Are there specific TP53 mutations that are overrepresented in ecDNA+ tumors relative to ecDNA-?
- Do these correspond to specific functional properties of TP53?


3/17/2022

Getting started on the HGG CBTN cohort

How many samples?
	104 patients
	

Questions for Sunita:
	PedPanCancerAC - what is the difference between master and amplicon samples?
	#Patient ID confusion? PT_3AWKWZEV in table but biosamples belong to PT_3AWKWXEV.
	We should have 104 patients, where are the others?
	
SigProfiler and deconstructSigs on Cavatica
	Cavatica already has a tool deconstructSigs which takes a VCF. Guess I'll try it first.
	Regardless, we need a vcf
	
	Test case: PT_37B5JRP1
	Variant data available:
		.consensus_somatic.protected.vcf.gz
		.consensus_somatic.public.vcf.gz
	Bcftools view to get vcf input
	deconstructSigs generates plots for sample, fit, error and signature composition.
	Eg. PT_37B5JRP1:
		signature 1: 39%
			spontaneous 5mC deamination. small insertions and deletions.
		signature 3: 18%
			Signature 3 is associated with failure of DNA double-strand break-repair by homologous recombination.
		signature 8: 25%
			unknown aetiology
		signature 16: 7%
			unknown aetiology
			
	Unfortunately, there is no SBS signature yet associated with NHEJ dysfunction.
	There are, however, ID signatures: ID6 (HR) and ID8 (NHEJ).
	Therefore we could hypothesize that one or the other is sufficient to cause ecDNA.
	

3/17/2022

Installing SigProfiler on Expanse and/or Cavatica.

METHODS
+ build singularity image: /expanse/lustre/projects/csd677/collab/bin/singularity-SigProfiler
- download test dataset: /expanse/lustre/projects/csd677/collab/projects/MB_ecDNA/somatic_variants
	(ICGC DACO access expired?)
- write script to SigProfilerMatrixGenerator
- write script to SigProfilerExtractor  
- Wrap in CWL on Cavatica

Notes:
- Install references to site-profiles: https://github.com/AlexandrovLab/SigProfilerExtractor/issues/16
-SJ VCFs in hg38.

RESULTS
Almost no mutations successfully analyzed for all samples except s2 (RCMB56). why is that?
wc of all samples:
     431 SJMB001_D.Somatic.vcf
     582 SJMB002_D.Somatic.vcf
     613 SJMB003_D.Somatic.vcf
     773 SJMB004_D.Somatic.vcf
     383 SJMB006_D.Somatic.vcf
    5701 SJMB008_D.Somatic.vcf
     565 SJMB009_D.Somatic.vcf
     537 SJMB010_D.Somatic.vcf
	...
  137520 s2.mutect2.filtered.vcf

Looks like RCMB56 file has 50-fold more mutations than the others. Have the SJ files been filtered
for pathogenicity?
Annotated with SNPeff, but no filtering documented.
St Jude documentation: https://stjudecloud.github.io/docs/guides/genomics-platform/requesting-data/about-our-data/
From this, it looks like Somatic vcf files have (probably) been filtered. Next: see if gVCF works?
gVCFs of Germline and Diagnosis. Not usable without further processing.

Can I use KF files?
- can download, can't wget from link
- protected.vcf - 4000/12000 lines are header...
- 2 biosamples present. BS_0JS89ADT BS_8Q8N6AHW
- public.vcf - 3400/11000 lines are header...
- also contains same 2 samples.

BS_0JS89ADT - normal
BS_8Q8N6AHW - progressive
KF also of Germline and Diagnosis. How do I need to process these?
Docs on protected/public.vcf files:
	https://github.com/kids-first/kf-somatic-workflow/blob/master/docs/kfdrc-consensus-calling.md
	https://github.com/kids-first/kf-somatic-workflow/blob/master/docs/kfdrc_annotation_subworkflow.md
Can I use the maf files instead?

     1920 591919fb-97e1-4b20-8016-94092b6de104.consensus_somatic.public.maf
     2301 5d0c9e3d-4709-45f6-8c4b-86a74c82b8d9.consensus_somatic.public.maf
     3208 5f18365f-f495-4ae6-9b16-73a4202eaad1.consensus_somatic.public.maf
     3281 5f9274c8-e86c-4162-adb3-4aebe6b1bd24.consensus_somatic.public.maf
     3842 6160f8b7-f3e1-4e8d-b0ab-c61455b59955.consensus_somatic.public.maf
     1496 6b1fad27-13c2-4b6c-bf3f-daa93fbce87c.consensus_somatic.public.maf
     3692 6c3e5d6f-0bee-44fe-83aa-ce5af9e2fc51.consensus_somatic.public.maf
     4304 70a5d569-a067-42bb-92a9-41fe24436ee3.consensus_somatic.public.maf
     3063 75fe91a8-f4bc-4e55-83f8-58e2b3811986.consensus_somatic.public.maf
     2585 78cd7ae8-1aba-4d65-a3a2-c434297528e0.consensus_somatic.public.maf
     6947 7908ae38-b552-4770-8462-652ed14ec5e8.consensus_somatic.public.maf
     1919 79e20064-c61d-41e7-9e6e-30019f417b89.consensus_somatic.public.maf
    12766 7af94157-5718-414e-b726-4a1863265c71.consensus_somatic.public.maf
     2172 7bbc2a19-8580-46b7-8e26-7a208d3c3a27.consensus_somatic.public.maf
	 ...

Success. mutation matrices for KF medulloblastomas stored at
/expanse/lustre/projects/csd677/collab/projects/MB_ecDNA/somatic_variants/sigprofiler


3/22/2022

Deploy SigProfilerExtractor to Expanse

NB: St Jude has a pipeline:
https://stjudecloud.github.io/docs/guides/genomics-platform/analyzing-data/mutational-signatures/

Timed out at 12h. Increase time limit to 2d and 12 cores.


3/23/2022

API requests to pedcbioportal

Docs on bravado library for Swagger APIs:
https://bravado.readthedocs.io/en/stable/requests_and_responses.html

Swagger API URL:
https://pedcbioportal.kidsfirstdrc.org/api/swagger-ui.html#/Studies/getStudyUsingGET


4/15/2022

NB: Code to rename files with prefix.
for f in *; do mv $f $new_prefix${f#"$old_prefix"}; done


4/18/2022

Progress report
432 AA runs
1785 total biosamples we wish to analyze
968 from CBTN


4/26/2022

Fusion annotations
annoFuse - included in PBTA-CBTN Open Access project.
	LeftBreakpoint	RightBreakpoint	FusionName	Sample	Caller	Fusion_Type	JunctionReadCount	SpanningFragCount	Confidence	annots	Gene1A	Gene2A	Gene1B	Gene2B	BreakpointLocation	SpanningDelta	reciprocal_exists
	2:74823579	2:74867636	AC007387.1(68760)/AC019069.1(9076)--HK2	BS_AHEFXG7W	ARRIBA	other	1	1	low	[],deletion/read-through	AC007387.1	AC019069.1	HK2	NA	Intergenic	0	FALSE
	Includes STARFUSION and Arriba

STARfusion
	#FusionName	JunctionReadCount	SpanningFragCount	SpliceType	LeftGene	LeftBreakpoint	RightGene	RightBreakpoint	LargeAnchorSupport	FFPM	LeftBreakDinuc	LeftBreakEntropy	RightBreakDinuc	RightBreakEntropy	annots
	AL355075.4--AL139099.5	8	20	INCL_NON_REF_SPLICE	AL355075.4^ENSG00000259001.3	chr14:20343075:-	AL139099.5^ENSG00000283029.1	chr14:49586762:+	YES_LDAS	0.2516	CA	1.4716	TG	1.7819	["INTRACHROMOSOMAL[chr14:29.24Mb]"]

arriba
	#gene1	gene2	strand1(gene/fusion)	strand2(gene/fusion)	breakpoint1	breakpoint2	site1	site2	type	direction1	direction2	split_reads1	split_reads2	discordant_mates	coverage1	coverage2	confidence	closest_genomic_breakpoint1	closest_genomic_breakpoint2	filters	fusion_transcript	reading_frame	peptide_sequence	read_identifiers
	SLC44A1	PRKCA	+/+	+/+	9:105385502	17:66732688	splice-site	splice-site	translocation	downstream	upstream	54	104	31	415	742	high	.	.	duplicates(24),mismappers(1)	GGTGCTGATAGTCTGCAGCACAGGTTTAGCTGGGATTATGCTGCTCAACTACCAGCAGGACTACACAGTATGGGTGCTGCCTCTGATCATCGTCTGCCTCTTTGCTTTCCTAGTCGCTCATTGCTTCCTGTCTATTTATGAAATGGTAGTGGATGTATTATTCTTGTGTTTTGCCATTGATACAAAATACAATGATGGGAGCCCTGGCAGAGAATTCTATATGGATAAAGTGCTGATG___GAGTTTGTGGAAAACAGTAGGAAAGCAATGAAAGAAGCTGGTAAGGGAGGCGTCGCTGATTCCAGAGAGCTAAAGCCGATG|AAAGCCAAACTTGGCCCTGCTGGCAACAAAGTCATCAGTCCCTCTGAAGACAGGAAACAACCTTCCAACAACCTTGACCGAGTGAAACTCACGGACTTCAATTTCCTCATGGTGTTGGGAAAGGGGAGTTTTGGAAAG___GTGATGCTTGCCGACAGGAAGGGCACAGAAGAACTGTATGCAATCAAAATCCTGAAGAAGGATGTGGTGATTCAGGATGATGACGTGGAGTGCACCATGG...CCTGCTTCCAGACAGTG___GATCGGCTGTACTTCGTCATGGAATATGTCAACGGTGGGGACCTCATGTACCACATTCAGCAAGTAGGAAAATTTAAGGgACC	in-frame	VLIVCSTGLAGIMLLNYQQDYTVWVLPLIIVCLFAFLVAHCFLSIYEMVVDVLFLCFAIDTKYNDGSPGREFYMDKVLMEFVENSRKAMKEAGKGGVADSRELKPM|KAKLGPAGNKVISPSEDRKQPSNNLDRVKLTDFNFLMVLGKGSFGKVMLADRKGTEELYAIKILKKDVVIQDDDVECTM	.
	
NB Biospecimen ID changes between DNA, RNA; but Sample ID does not.
	https://cavatica.sbgenomics.com/u/chapmano/pancancer-ecdna/files/61f42c2a6d452a42add61e9c/
	https://cavatica.sbgenomics.com/u/chapmano/hgg-ecdna/files/62684b2ed63f7c6d8d1b9f7f/


5/4/2022

Shanqing weekly

NB. The set of new samples I gave him is from the 3/2/2022 freeze of SJ RTCG data, and is not one of our downloads.
 Would we need to make a new data access request?
 How much would we lose if we used the existing 1/21 download?
	Shanqing to answer.

6/22/2022

Set up master relational database of Patients, Biosamples, and Files to be included in this study.
See updates to 2022-03-01_KF_samples/KF files.ipynb
Table at 2022-06-22_pedpancan-master-cohort-table.xlsx

Notes:
 - A few Biosamples appear to correspond to the same tissue sample. Most are have the same Biosample ID but same external sample ID.
   These correspond either to sequencing done twice on the same sample, or else a sample and its derived cell line.
 - Biosamples have a diagnosis associated in the KF database, but it is not included with the metadata given to us.
   We need a way to label each biosample with a tumor type diagnosis.


8/23/2022

CBTN office hours

Accessing TARGET data
support@sevenbridges.com - See if cavatica has globus endpoint
OR https://portal.kidsfirstdrc.org/dashboard
OR https://cavatica.sbgenomics.com/datasets/ (This UI is garbage)
research@cbtn.org

Wasnt able to access TARGET, did put KF osteosarcomas on CAVATICA.


4/19/2023

Fusion genes in ETMR

Goal
We see that 3 ETMRs have ecDNA amplifications within the C19MC region. What do we know about fusion transcripts from here?

PT_X648RVMK
AA:
	simple circle, breakpoints chr19:53650223-54436157
arriba:
	9abb3e6a-91a6-4d75-a81a-2ee8994f7e7e.arriba_2.2.1.fusions.pdf
	TTYH1 exon 12 - LOC107985342 intron 1 (https://www.ncbi.nlm.nih.gov/nuccore/XR_001753996.1/)

PT_01MZ62KG
AA:
	simple circle, breakpoints chr19:53659704-54425028
arriba:
	42d1b092-82c6-46df-a721-f3b9e43e04f0.arriba_2.2.1.fusions.pdf
	TTYH1 exon 4 - LOC107985342 exon 3. Fusion breakpoint corresponds to splice site.
	
PT_DQT78GS5
AA:
	simple circle, breakpoints chr19:53652881-54427994
arriba:
	eb98d609-6608-4ade-902b-3f2b6440b679.arriba_2.2.1.fusions.tsv
	TTYH1 exon 5 - LOC107985342 exon 3. Fusion breakpoint corresponds to splice site.

Aliases LOC107985342 RNU6-698P XR_001753996.1
	
4/19/2023
Fusion genes in RMS

PT_1DRAVX4S
arriba:
	3be0dafe-8325-4f27-9c49-eb92a081fa3c.arriba_2.2.1.fusions.pdf
	PAX3 exon 7 - NCOA1 exon 14

SJ003909/SJRHB009_D
SJ031244/SJRHB031244_D2
	only CNV and simple somatic variants available.
	
Cancer ontology
http://oncotree.mskcc.org/#/home

5/11/2023

Protocol to deposit CBTN X01 data on AmpliconRepository

Data at https://cavatica.sbgenomics.com/u/cavatica/pbta-cbttc/files/#q?path=CBTN-X01%2Famplicon-architect

$AC/make_input.sh CBTN-X01 batch-classifier-input
python /home/ochapman/bin/AmpliconClassifier/amplicon_classifier.py --input batch-classifier-input.input --ref GRCh38
$AC/make_results_table.py --input batch-classifier-input.input --ref GRCh38 --classification_file batch-classifier-input_amplicon_classification_profiles.tsv --summary_map batch-classifier-input_summary_map.txt
tar -cvzf CBTN_X01_AmpRepo.tar.gz batch-classifier-input* CBTN-X01 files/ index.html
# AmpliconSuiteAggregator


5/18/2023

Methylation classifications of CBTN data

https://cavatica.sbgenomics.com/u/cavatica/opentarget/files/644fd7817f32657130c8d641/
(v12/histologies.tsv)

BS_9P4NDTKJ	7316-3232	556479	PT_KBFM551M	WGS	Tumor	Solid Tissue	Initial CNS Tumor	Pons/Brainstem	Male	White	Not Hispanic or Latino	3425	Brainstem glioma- Diffuse intrinsic pontine glioma	NA	395	DECEASED	NA	PBTA	3820	NantOmics	None documented	Diffuse Astrocytoma	C3079182	NA	Midline	NA	NA	Male	0.587088332	0.412911668	4	3425	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	HGG, H3 wildtype, TP53	High-grade glioma, IDH-wildtype and H3-wildtype	Updated via OpenPedCan subtyping	High-grade glioma, IDH-wildtype and H3-wildtype	NA	Diffuse astrocytic and oligodendroglial tumor	HGAT	High-grade glioma
BS_M0B42FPR	7316-3214	A07094	PT_KBFM551M	WGS	Tumor	Solid Tissue	Initial CNS Tumor	Pons/Brainstem	Male	White	Not Hispanic or Latino	3425	Brainstem glioma- Diffuse intrinsic pontine glioma	NA	395	DECEASED	NA	PBTA	3820	NantOmics	None documented	Diffuse Astrocytoma	C3079182	NA	Midline	NA	NA	Male	0.447427285	0.552572715	3	3425	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	NA	HGG, H3 wildtype, TP53	High-grade glioma, IDH-wildtype and H3-wildtype	Updated via OpenPedCan subtyping	High-grade glioma, IDH-wildtype and H3-wildtype	NA	Diffuse astrocytic and oligodendroglial tumor	HGAT	High-grade glioma


6/22/2023

New sources of WGS

COG
Looks like there's an application for database access:
	https://childrensoncologygroup.org/data-sharing
Unclear if we need access to Case Report Forms (CRF) for patient metadata, eg survival.


6/26/2023

pedpancan updated sample counts

SJ
	current	latest	Total
sample_type			
diagnosis	746.0	684.0	1430.0
xenograft	0.0	327.0	327.0
relapse	40.0	23.0	63.0
metastasis	21.0	11.0	32.0
autopsy	0.0	28.0	28.0
Diagnosis	8.0	0.0	8.0

CBTN
tumor_descriptor
Deceased                            104
Initial CNS Tumor                  1455
Progressive                         246
Progressive Disease Post-Mortem       3
Recurrence                          142
Second Malignancy                    22
Unavailable                           3

Unique biosamples:
CBTN	1976
SJ		1553
Total	3529

Unique patients:
CBTN	1778
SJ		1345
Total	3123

Primary biosamples:
CBTN	1455
SJ		1438
Total	2893

Progressive biosamples:
CBTN	517
SJ		123
Total	640

1/8/2024
OSC
- Added functionality annotate biosamples with amplicon class
- Added BS_K07KNTFY from Chapman 2023
- Annotate deduplicated tumor set
- Generate suppl. Tbl. 1
- Revised tumor type annotations. See filtered_mapping.xlsx,
	https://www.molecularneuropathology.org/mnp/classifiers/14
	https://university.stjude.cloud/docs/genomics-platform/about-our-data/metadata-and-clinical/

1/22/2024
Gene amps

SJRHB003_D: MEGF10, RAF1
SJRHB004_D: no strong candidates, maybe MAFK
SJRHB001_D: COPS9, HDAC4

2/24/2024

Differences between AC 0.5.4 and 1.1.2

Biosample	amplicon	0.5.4 class	1.1.2 class	correct
BS_B1163H1W	amplicon32	ecDNA		CNC		1.1.2
BS_MEE1Y50H	amplicon1	Linear		CNC		BFB
BS_EJP43CD9	amplicon1	CNC		ecDNA		???
SJBT030078_D1	amplicon1	No amp		BFB		1.1.2
SJHGG019_S	amplicon2	Linear		BFB		1.1.2
SJNBL196_R	amplicon1	CNC		ecDNA		???
SJOS001125_D1	amplicon3	CNC		No amp		1.1.2
SJOS004_D	amplicon7	Linear		No amp		1.1.2
SJRHB008_D	amplicon1	ecDNA		ecDNA		both
SJOS012_D	amplicon2	ecDNA		CNC		BFB?


5/13/2024

Goal: keep better lab notes

Methods: 
[1] Reviews (with Sunita’s and my comments) at manuscript/2024-03_initial-submission/NG_reviews.docx
[2] Todo list at manuscript/2024_current-draft/TODO.xlsx


5/13/2024

RNA-seq

GOAL
Evaluate CBTN RNA-seq data w.r.t. ecDNA. 

METHODS
0. Ran the following protocols on just CBTN-X00 and CBTN-X00 + CBTN-X01 sets.
1. Data from Cavatica; 1922 rsem.genes.results files.
2. Merge files into gene expression matrices using "SBG Create Expression Matrix CWL 1.1". TPM for GSEA; expected counts for differential expression.
3. Samples are listed by PBTA ids (7613-XXXX). Match IDs to metadata. See 2024-04-19_RNAseq/cbtn-gsea.ipynb and 2024-04-19_RNAseq/cbtn-differential-exp-inputs.ipynb
4. GSEA 
Run in genepattern (ids 584573-6, 585741-2)
experimental design:
	2 comparisons: 
		ecDNA vs chromosomal
		ecDNA vs no amplification
	3 set libraries:
		GO (c5)
		Hallmarks (H), curated sets (c2), curated cancer cell atlas (c4.3ca), oncogenic signatures (c6)
		Custom histone sets
5. Differential expression
Limma-voom (see 2024-04-19_RNAseq/cbtn-edger.ipynb
formula = ~ data$annot$sex + data$annot$tumor_history + data$annot$age_at_diagnosis + data$annot$extent_of_tumor_resection + data$annot$cancer_type + data$annot$amplicon_class

RESULTS

X00
All top gene sets include replication dependent histones (H[1-4][A|B]?C[1-30]
Differential expression shows concurrent upregulation; most of the set significantly upregulated

Full CBTN PBTA set (X00+X01)
RDH all show greater expression in ecDNA+ samples, but individual genes no longer significant.
GSEA: all histone sets nominally significant vs no amp, RDH but not NRDH or pseudogenes significant vs chromosomal.

Interesting differentially expressed genes:
UP:
	GFAP: marker for glial tumors inc. glioblastoma, astrocytomas.
	SLC39A12 (ZIP12): Zinc transporter, required for neuronal development & mitochondrial function
		https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8318780/
		https://www.pnas.org/doi/abs/10.1073/pnas.1222142110
	HOXA@ cluster HOXA6, HOXA9, HOXA10
	S100B
DOWN:
	XRCC4
	CCNB1
	RAD51
	CENPK
	AURKA
	CENPN
	SMC2
	CENPL
	RAD17
	PRIM2
	TIMELESS

TODO: 
Adjusted p < 0.10
Add:
UP:
	CDKN2A
	MSI1
	POLN
	MYCN
DOWN:
	PALB2
	MSH3
	RAD23B
	RAD51AP1
	BRD8
	CDKN3
	ERCC6L
	CDK1


DISCUSSION

Current story goes: 
We performed differential gene expression analysis, including x, y, and z as covariates. Following multiple hypothesis correction, N significantly unregulated genes 
in the ecDNA condition included cell lineage-specific markers S100B (astrocytes) and GFAP (glial lineage), HOXA developmental gene cluster members HOXA6/9/10, etc.
M significantly downregulated genes included notable genes essential for normal DNA damage response, cell cycle progression, and mitosis: CCNB1 (mitotic switch), 
AURKA (spindle assembly), SMC2 (chromosome condensation), centromere proteins CENPK/N/L, RAD17 (DNA replication fidelity), RAD51 (homologous recombination) XRCC4 (non-homologous end-joining),
and TIMELESS (cell survival) (Figure Xa).
We performed gene set enrichment analysis to identify biologically relevant gene sets co-ordinately up- or downregulated in ecDNA+ samples. 
Two comparisons were performed, against tumors with intrachromosomal amplification and those in which no focal amplifications were detected. Gene sets tested were GO terms. Nominally significantly
enriched sets in both comparisons included several gene sets including replication-dependent histone cluster genes (Figure Xb). Replication-dependent histones are expressed during DNA replication 
or repair and are located in 2 gene clusters on chromosomes 6 and 22; neither genomic locus is amplified in the ecDNA+ tumors included in this analysis. To investigate further, we defined sets of replication-dependent histones, constitutive histones, and histone pseudogenes from a recent review, and performed a follow-up GSEA. Compared to tumors with intrachromosomal amplification, the replication-dependent 
histone set but not the constitutive histone or the histone pseudogene sets were upregulated in ecDNA+ tumors (Figure Xc). Further examination of our the differential expression model confirms that various replication-dependent histone genes were coordinately overexpressed in the ecDNA condition with modest but nominally significant fold change (Figure Xd).

TODO
- Differential gene expression list to Sunita
- Immunology gene set enrichment analysis

6/21/2024 ADDENDUM

DSBR GSEA

Ran GSEA on DSBR sets defined in Lin et al 2024. All significantly upregulated in ecDNA vs no amp; none upregulated in ecDNA vs intrachromosomal.


6/20/2024

Oncogenes

Reviewer notes:
- Paragraph “ecDNA is a common carrier of amplified oncogenes in pediatric cancers”. Although there is no global census of ecDNA in paediatric cancers, if one were to google “double minutes” or “extrachromosomal DNA” or “neochromosomes” and individual entities, one would find many hits. Furthermore, some of the genes the authors list in this paragraph and claim to be oncogenes, are not oncogenes (as per COSMIC CENSUS of cancer genes). PTPRB, FLCN, CNOT3and NCRO1 are tumour suppressor genes. FIL1L1, OS9, and TOP3A are not cancer genes.  

FIP1L1 is in ONGene.
Not trying to claim that OS9 and TOP3A are oncogenes.
FLCN, CNOT3, NCOR1, and PTPRB are not in either set.

DISCUSSION
With Jens, found the issue.

TODO:
Update PedPanCancerAmpliconAnalysis.Rmd to use Supplementary Tables.xlsx sheet 5 instead of COSMIC_allgeneset.csv and combinedamplicons.xlsx.


6/25/2024
Added BS_D67XNVBS to Supplementary Tables, was misnamed for some reason in the CBTN-X01 data.


6/25/2024

Grouped AA analysis

BACKGROUND
Best practice is to run AA in Grouped analysis mode to properly compare related samples. 
Under the hood, this involves samtools merging and sorting the seed files to run the same seed across all related samples.
Regrettably, the CBTN-X01 output does not include the seed file. 

METHODS
- Write Cavatica app to run in Grouped samples mode. (Done)
- Write script to id and run all the samples that need to be run in Grouped mode.
- Write St Jude app to do the same.

TODO
- X01 cohort tumor and normal .bam files are unavailable.



7/22/2024

Working AmpliconSuite-pipeline GroupedAnalysis.py implementation on Cavatica.

Successful AmpliconSuite-pipeline test (rcmb56)
https://cavatica.sbgenomics.com/u/chapmano/pancancer-ecdna/tasks/6ba7ea70-bf33-48dc-aa53-0436deab3cf0/


Lots of help from Miguel and Dan.

RESULTS
PT_00G007DM	https://cavatica.sbgenomics.com/u/chapmano/pancancer-ecdna/tasks/895c6b64-02c1-41ad-8afb-9001024d9f59/
	BS_AQMKA8NC	no amp
	BS_K07KNTFY	cnc*,#


* This is a change from our 2020 results.
# Seems an issue with differing seed regions? Jens says extend the seed (or use the og) and run it again.



7/30/2024

tumor_fraction = Theta2
https://github.com/AlexsLemonade/OpenPBTA-analysis/blob/e854738b57b16c3725673ad63b4ffd20ec48ad19/tables/write-manuscript-tables.Rmd#L264


8/14/2024

Longitudinal results 

PT_00G007DM	No change
PT_02J5CWN5	No change, no amp, not sure why I ran this…
PT_37B5JRP1
	BS_EJV0N3BX ecDNA -> CNC
		old result (amp1) ecDNA, chr17p11.2. I don't see a circle. No edges at CN breakpoints.
		new result (amp2) CNC.
	BS_8Q8N6AHW CNC -> CNC
PT_3VCS1PPF 	No change

PT_3WA7SBQ6
	BS_HN8DE43A	NA -> NA
	BS_2F8PFTW5	CNC -> Linear
	BS_XB34VS6P	ecDNA -> Linear
		old result probably a false positive /Users/ochapman/SBP/projects/pedpancan_ecdna/2023-11-27_cavatica-api/out/amplicon-architect/PT_3WA7SBQ6/BS_XB34VS6P/PT_3WA7SBQ6-BS_XB34VS6P_amplicon1.png
		new result same as other samples: /Users/ochapman/SBP/projects/pedpancan_ecdna/2024-02-29_longitudinal-samples/AmpliconSuite-Grouped/PT_3WA7SBQ6/BS_XB34VS6P/BS_XB34VS6P_AA_results

PT_5CYJ3NZ9
	BS_VRDQTVHR	ecDNA -> ecDNA
		Amp1 and amp2 got combined, incorrectly. Amp1 is ecDNA, amp2 is CNC in the old result; amp1 is ecDNA in the new result.
		Old result: /Users/ochapman/SBP/projects/pedpancan_ecdna/data/source/AmpliconArchitect/CBTN-X01/CBTN-X01-rename/PT_5CYJ3NZ9/BS_VRDQTVHR
		New result: /Users/ochapman/SBP/projects/pedpancan_ecdna/2024-02-29_longitudinal-samples/AmpliconSuite-Grouped/PT_5CYJ3NZ9/BS_VRDQTVHR/BS_VRDQTVHR_AA_results
	BS_7M145V8M	no change

PT_89XRZBSG	amplicon1 linear -> ecDNA
	file:///Users/ochapman/SBP/projects/pedpancan_ecdna/2024-02-29_longitudinal-samples/AmpliconSuite-Grouped/PT_89XRZBSG/BS_X1DSETVE/BS_X1DSETVE_AA_results/BS_X1DSETVE_amplicon1.pdf
	Doesn't look like ecDNA to me

PT_8GN3TQRM	Timeout
PT_FWWRWTV2	Timeout
PT_MDWPRDBT	OOM

PT_S9YT3GSS
	BS_AVMVWGX0 ecDNA but doesn't look super convincing? CN roughly 10.

PT_S0Q27J13
	BS_G6KYSGQF ecDNA -> No amp

PT_Z4BF2NSB
	BS_W2QCHQ7E CNC -> ecDNA
		I don't see strong justification for the new classification. CN < 3 for the cycles.
		KRAS not amplified
	BS_EJP43CD9 ecDNA -> ecDNA
		amp1 is identical to the primary.
		amp2 (KRAS) is clearly cyclic. 
	tl;dr pretty unclear whether amp1 (MYCN) is ecDNA or not, but probably not (low CN). Weirdly, 
	both old and new runs get this wrong; old is right in the primary, wrong in the relapse;
	new is wrong on both. 
	amp2 (KRAS) is absent in the primary and present in the relapse. Thus, despite getting amp1 wrong,
	the old result ends up with the right classifications for the sample and patient.


Conclusion:
Reclassify PT_3WA7SBQ6, PT_S0Q27J13 as ecDNA-
	DONE 10/14/2024

Add entries to Suppl. Tbl. 7:
	PT_5CYJ3NZ9
	PT_7WYPEC3Q
	PT_7WYPEC3Q
	PT_7WYPEC3Q
	PT_82MX6J77
	PT_BRVGRXQY
	PT_H9QTP1JF
	PT_Z4BF2NSB
Remove entries from Suppl. Tbl 7:
PT_3WA7SBQ6	0,0,1	BS_2F8PFTW5	Recurrence		CNC	BS_XB34VS6P	Recurrence		ecDNA


9/9/2024

PedPanCancer DNANexus project deconfusion

GOAL
We have 2 projects on DNANexus, a half-dozen sample_info files, and as as many directories containing .bam files. How is it organized??

METHODS
See 2022-02-03_sj_samples/sample-info-deconfusion.ipynb.

RESULTS
- New file out/SAMPLE_INFO_SJ00.txt containing sample metadata for all WGS files in our DNANexus projects as of 9/2024.
- Data appear to be stored in project "PedPanCan" and then copied to "PedPanCancer ecDNA" for analysis.
- File names are (supposed to be) unique within the project. According to the SJ docs, if a file already exists which is meant to be added to the project, it is skipped.
- This means that the files listed in sample_info do not match 1:1 with the files actually in that directory. See for example project-Fk1P9x09ZgZJbb0q38XffZJB:/Data Requested 2022-08-29 - Pediatric Cancer Genome Project/SAMPLE_INFO.txt, but the BAM directory is empty.
- All human tumor WGS are in restricted or Data Requested 2022-09-06. These have been copied from PedPanCan to PedPanCancer ecDNA.
- About half of these are not yet analyzed.
- Should probably send another sample request to RTCG.

TODO
Actually run AA on these tumors.


9/9/2024

AmpliconSuite on DNANexus

METHODS
Code: https://github.com/chavez-lab/ampliconsuite-dnanexus-applet


9/15/2024

Running AA on SJ samples

See 2022-02-23_sj_samples/run-aa-sj-samples.ipynb

Failures
AmpliconSuite SJST030425_D2	Error while loading job output JSON: Expecting value: line 1 column 1 (char 0)
SJST032870_D5
SJMB031905_D1
SJHGG031234_D1
SJOS031809_D2
SJRHB032248_D1
SJNBL032818_D1
SJNBL032572_D2
SJNBL033206_D1
SJRHB031654_D2
...

DONE Rerun timeouts with higher CN threshold? Or other stricter filtering parameter

9/27/2024 AA run notes

633 entries in progress.txt = WGS files
616 unique entries. 17 duplicates.
616 directories on DNANexus.
586 downloaded folders.

Missing folders correspond to failures without any output files.
This includes timeouts and runs listed as "success" but with empty outputs.
These latter correspond to samples where the total disk space is less than the total size of the WGS file.
Presumably the cause of the failure; rerunning on azure:mem2_ssd1_x16 instances.


9/24/2024

Debugging data_imports

Eugene brought to my attention that the Suppl. Tbls. have missing and duplicate entries.
Duplicated Patient Entries:
PT_3KM9W8S8
PT_6PP78VNE
PT_85RSG67R
PT_BXXZE0CQ
Duplicated Biosample Entries:
BS_2S93EQPX
BS_4XS444TD
BS_DJYDRZWZ
BS_RCC7ZEC0
BS_ZXP6G6WS
SJNBL105_D
SJNBL124_D
SJOS001108_M1
SJOS001126_D1
SJRHB011_D
SJRHB012_S
Missing following Biosample Entries:
BS_4DQAQFQH - cell line
BS_AFBPM6CN - cell line
BS_JGKRN7NA - cell line
BS_TF5TTEXH - cell line
BS_XMP9XNR9 - cell line
SJHM030102_D1 - hematologic malignancy
Missing gene CN statistics for CCL27

DONE revised to use histologies.tsv for cell line IDs instead of an old pedcbioportal file, removes BS_7ZA2AYHR.
DONE bugfix deduplicate patient and biosample entries. Metadata tables must be deduplicated on index before merging with AC results.
	Duplicate patient entries: this caused by duplicate AA runs in X00 and X01. Solution: remove X00 runs.
DONE filter amplicon table:
- deduplicate
- remove runs not corresponding to a biosample
TODO
- Wait for SJ runs to finish
- Run AmpliconClassifier
- Update suppl. tbls.

10/1/2024

Integrate SJ results

Known true positive example: SJHGG032492_D1.WholeGenome_amplicon1.png

10/10/2024
Revisions to SJ tumor types this week.
New classes PINT (pineal tumor), PNST (peripheral nerve sheath tumor)


10/25/2024

Bug review: PT_19GCSK2S has BFB, linear amps but is classified as no amp??

Resolution

To: Lukas, Sunita.
Hi both,
Last meeting Sunita pointed out to me a patient labelled with “no amplification” despite some biosamples 
associated with this patient having non-ecDNA amplifications. Thanks Sunita for finding that bug. I have updated 
the generating logic to fix the  issue. She has also furnished me with survival data from Dubois et al., 2021. 
The latest S.T.s incorporate both of these changes, with the following effects:
	- ‘Linear’, ‘Complex noncyclic’, and ‘BFB’ sample and patient annotations are deprecated in favor of ‘intrachromosomal’. 
	  ‘No amplification’ is changed to ‘no amplification’;*
	- 21 patients now annotated as ‘intrachromosomal’ which were previously incorrectly annotated as ‘no amplification’;
	- 12 patients with survival data which previously did not;
	- 30 biosamples ‘cancer_subclass’ field changed from ‘HGGNOS’ to a more specific annotation (HGG_H3K27, HGG_H3G34, or HGG_H3WT).
 
I have pushed these changes to the OneDrive version of the Suppl. Tables and versioned the old one as 20241025.
 
* A better programmer than I would have decoupled this change from the bug Sunita reported, but I haven’t. Under the hood, 
this is because I use a sort on these terms to label samples and patients, which works because ‘ecDNA’ < ‘intrachromosomal’ < 
‘no amplification’ in alphabetical order.

11/11/2024

Recurrently amplified regions (3a)

Recurrent n>2 some without a known oncogene
	LINC01935
	HPCAL1 / ODC1 / SNORA80B (always coamplified with a known oncogene though, usually MYCN)
	TRPS1 / EIF3H (2/3 coamp with RAD21 just downstream)
	SMIM38 / MYEOV (2/3 coamp with CCND1 downstream)
	LDHB (!) / ABCC9 / CMAS
	BCAT1
	CAPS2 / GLIPR1 (!) / GLIPR1L1 / GLIPR1L2
	GPC5 partial GPC6 partial


Recurrent n=2 (plot getting too crowded)
	PAX7 partial
	ALK partial
	TNR 
	PTPN14 partial
	MYT1L partial
	SILC1 partial
	KLF11
	OXER1 / HAAO (always coamp with MYCN)
	BAZ2B (!) / LY75 / PLA2R1 / ITGB6 / RBMS1 / TANK / TBR1 / SLC4A10 / FAP / GCG / GCA / KCNH7 / FIGN
	WDR48 / TTC21A / GORASP1 / XIRP1
	MARCHF6 / ROPN1L / ANKRD33B / DAP (coamp with MYC and IGF1R)
	ABCC10 partial
	VEGFA partial
	SPATS1
	RUNX2 / CLIC5 / ENPP$ / ENPP5 / RCAN2
	SLC25A27 / TDRD6 / PLA2G7
	MYB partial
	STEAP1B
	CDK14 rearranged
	TNKS (!)
	RUNX1T1 partial
	SDC2 (!)
	HAS2 (coamp with MYC)
	RBM20 / PDCD4 / BBIP1 / SHOC2 / ADRA2A / HEAT2
	RRAS2 (!) / COPB1 / PSMA1 / PDE3B / CALCA / CALCB / INSC
	B4GALNT3 / NINJ2 partial
	WNK1 partial
	CAPRIN2 / TSPAN11 / SINHCAF / DENND5B ETFBKMT / AMN1 / DDX11 / RESF1 / BICD1
	PRICKLE1 / ADAMTS20 / PUS7L
	CDX2 / URAD / FLT3
	FOXO1 partial
	SUCLA2 / NUDT15 / MED4 / ITM2B
	SLC10A2 / DAOA
	IRS2
	GATA6 (!)
	RIOK3 (!) / RMC1
	TTC39C / CABYR / OSBPL1A

Other notes:
	17p11.2 is especially confusing. Maybe make a plot. 
	DUSP22 (chr6) exclusively not ecDNA
	Some distributions are very skewed - selective pressure for 2nd oncogene or enhancer


TODO:
Current sample deduplication loses important amplicons, eg. 2nd ecDNA of PT_XA98HG1C (BS_5JC116NM is listed as the deduplicated sample
	but BS_W37QBA12 and BS_2J4FG4HV have a second ecDNA).
	(DONE)
Deduplicate 1st and 2nd SJ AC runs eg. 
	SJST031395_D1_amplicon1_ecDNA_1_intervals.bed vs 
	SJST031395_D1.WholeGenome_amplicon1_ecDNA_1_intervals.bed
	DONE
Plot of only ecDNA without known oncogenes?
Plots of interesting regions? PDGFD? chr17p11.2?


11/22/2024

Circularizations

Are the longitudinal results reported as circularizations legit?

PT_FWWRWTV2 
	BS_1061K466 (BFB) amp1 includes MET dup but other stuff. Probably not circular?
	BS_9BJ4Z98D (ecDNA) amp2 includes MET tandem dup but other stuff too. Could be circular.

PT_MDWPRDBT
	BS_D368BNRD (CNC) amp1. High-copy, chromothriptic from lots of chromosomes. Not all CN breakpoints have edges.
	BS_00TRPEQX  (ecDNA) amp1. High-copy, chromothriptic, also missing breakpoints. Change in class seems arbitrary.

PT_Z4BF2NSB
	See notes above. I think the "circularized" amplicon (MYCN) is insufficiently supported. If we use the
	new AA results, both are circular. Either way, not a circularization.

Conclusion: use PT_FWWRWTV2 as the example.

12/19/2024

Expression reanalysis

Re-examining our differential gene expression results.

METHODS
Changes since the first version:
- H1-1, H1-2, H1-3, H1-4, H1-5, H1-6, H4-16 reclassified as rdh
	H1 genes are clustered, stem loop, and cell cycle dependent.
	H4-16 is not in the clusters but has a stem loop and is cell cycle dependent.
- GSEA includes pathway sets from KEGG, Reactome and Biocarta.
- Performing additional comparisons:
	ecDNA+ vs ecDNA- to replicate Lin et al.
	amp+ vs amp- for my own curiosity.
- GLM should also examine amp+ vs amp-.

DISCUSSION

replication-dependent histones
This set is puzzlingly nonsignificant in ec vs ch comparison although the plot sure looks like it trends
that way. Looking at the few genes down... in this comparison:
	H3-4. Not in a big cluster, but near H2AC25 (H2AW) and H2B26 (H2BU1). Both are highly up in ec.
	H2BC1. testis-specific.
	H2AC1. testis-specific.
	H1-6. No info.
	H4C6. No info.
	H4-16. Not in a cluster, but has a stem loop and is cell-cycle regulated.
	H4C7. "All human H4 genes encode the same protein except for H4C7, which encodes an H4 protein with 
	a truncated C terminus...
	A study [48] of the putative protein encoded by human H4C7 found that it is expressed at 
	low levels and in vitro forms unstable nucleosomes. The H4C7 gene is annotated as protein coding 
	because several unique peptides from proteomic projects map to the H4C7 locus on the human genome 
	reference GRCh38; however, as this gene has only been reported to be expressed in tumor cells, 
	its existence as a true histone variant in normal cells is in doubt."
	H2AC19. Duplicated w/ H2AC18. 
	H2BC10. No info.
	H2BC6. No info.
	H2BC14. No info.
	H2AC14. No info.

TODO
Genes of interest:
	NPAT - histone transcription factor
	CENPA - centromere-associated histone
	CHK1 - drug target
	H2AW, H2BU1, H3C15, H3C13 - significant histones
	HOXA9, HOXA10, HOXA6 - significant HOX genes
	LHX1, LHX5, LDB1 - neurodevelopmental tfs
	RAB3A, STXBP1, PPFIA4, PPFIA3, PPFIA2, SNAP25, SYT1, RIMS1, CHAT, STX1A, SLC5A7 - acetylcholine core enrichment set
	RAB3A, STXBP1, PPFIA4, SYN1, PPFIA3, PPFIA2, LIN7B, SNAP25, SYT1, RIMS1, LIN7C, STX1A - dopamine core enrichment set
	RAB3A, STXBP1, PPFIA4, SYN1, PPFIA3, PPFIA2, SNAP25, SYT1, RIMS1, STX1A - serotonin core enrichment set
	RAB3A, STXBP1, PPFIA4, PPFIA3, PPFIA2, SNAP25, SYT1, RIMS1, STX1A - norepinephrine core enrichment set
	TODO - SECRETORY_GRANULE_LOCALIZATION
	TODO - PRESYNAPTIC_ACTIVE_ZONE_CYTOPLASMIC_COMPONENT

2024-12-21
Paired
PT_82MX6J77	- use biosample GBSSZBMF instead of P42V737Y (GBSSZBMF is the secondary from which the progressive originates)

2025-01-07
Depositing results on AmpliconRepository.

Chatted with Jens, he needs _CNV_CALLS.bed files, or failing that, .cns or .cnr files for complete AR entries.
We don't have those unfortunately. Nevertheless, will zip and send AA and AC results to see if he can get
them onto AR. 

Dropped 9/24 st jude AA results to:
	/Users/ochapman/Library/CloudStorage/OneDrive-SanfordBurnhamPrebysMedicalDiscoveryInstitute/projects/2023-pedpancan/data/AmpliconArchitect/stjude/

Saved .tar.gz files of AA results, AC results to OneDrive/2023-pedpancan/data/

2025-01-10
Another revision of RNA-seq

Notes:

PBTA
- Looks like OpenPBTA run using Gencode 27 Comprehensive gene annotation, primary assembly: 
	https://github.com/AlexsLemonade/OpenPBTA-analysis/blob/master/analyses/README.md
	https://www.gencodegenes.org/human/release_27.html
- They make separate analyses for poly-A (n=58) and stranded (n=977) RNA-seq experiments.
	Rather than batch correction, they discard poly-A samples. See https://www.cell.com/cell-genomics/fulltext/S2666-979X(23)00115-5#sec-3-1
- rsem 1.3.1. https://github.com/d3b-center/OpenPBTA-workflows/blob/master/cwl/kfdrc_RNAseq_workflow.cwl
- Found the rsem reference RSEM_GENCODE27.tar.gz at https://cavatica.sbgenomics.com/u/kfdrc-harmonization/kf-references/files/5f500135e4b0370371c051be/
	cmd = "rsem-calculate-expression --paired-end --alignments --append-names --no-bam-output -p 16"
	(additional arguments --append-names -p 16)

St Jude
- Found an implementation of RSEM maintained by DNANexus: https://platform.dnanexus.com/app/rsem
- Uploaded RSEM_GENCODE27.tar.gz
- Test runs:
	job-Gy0JF109fj2VkbXPVv0KpPjg
		Input: SJACT001_D.RNA-Seq.bam, version created by user-naina_stjude
		Error: file does not exist.
	job-Gy0JXfQ9fj2kzfp6ZQ280F1j
		Input: SJACT030487_D1.RNA-Seq.bam, version created by user-clmcleod
		Error: file does not exist.
	job-Gy0Gx489fj2pBjQKfy21pJJ9
		Input: SJACT001_D.RNA-Seq.bam, version created by user-sjc.low.security.admin
		Error: Warning: The SAM/BAM file declares less reference sequences (195) than RSEM knows (200468)!
		 Please make sure that you aligned your reads against transcript sequences instead of genome.
		 RSEM can not recognize reference sequence name chr1!


TODO
- Delete all RNA-seq files not created by user-sjc.low.security.admin
	These seem to no longer exist.
- Possible strategies for RNA-seq analysis:
	Use FeatureCounts data provided. Probably best to analyze St Jude and PBTA data separately in this
		case, although a merge and batch correction could be attempted.
	Try to unearth RSEM results for these samples. Clay McLeod would know if these exist and where to find
		them, if I can get a hold of him.
	Convert RNAseq bams back to fastq, then realign with STAR to transcriptome, then quantify with RSEM.

2025-01-17

Suppl Fig. 2. updates

- Remove panel b -- DONE
- Add CycleViz for AKT amplifications -- DONE
	BS_M4E4H6NG
	SJHGG052_A
	SJRHB031519_D1

Notes on figures produced by CycleViz:
- Requires CycleViz >= 0.2.1 (Old figure produced using CV 0.1.10)
- Scale by 50%
- To place gene labels closer to genome tracks:
	Scale by 87.5%
	Scale all except gene labels by 8/7 = 114.286%
	Scale each gene label by 114.286%.

2025-01-19

TP53 reanalysis

TODO
- Reanalyze TP53 w.r.t. intrachromosomal - DONE
- Collate TP53 pathway mutations for SJC samples
	see https://pecan.stjude.cloud/variants/genomepaint/BT?gene=TP53

RESULTS
Looks like no difference between TP53 mutation prevalence in ecDNA and intrachromosomal.
Both are enriched relative to no amplification.

2025-01-27

Changes to Fig. 2

Reviewers indicated genes that shouldn't be there, and there are other genes that should.

Add:
	AKT3
	ODC1
	FOXP4
	TRPS1
	TTYH1

Remove:
	TFPT
	CNOT3
	FLCN
	CNOT2
	NCOR1
	LRIG3
	NTF3 (none that cannot be explained by CCND2)

Raise LRIG3, TFPT, CNOT3 with Jens.

2025-01-30

Gene expression code updates

METHODS
	Refactor to move a bunch of functions into gex.r
	New code to filter for only protein-coding genes
		Methods section for PBTA is a goddamn lie - gene names don't match gencode 27
		Filtered by stable Ensembl gene id instead

TODO
	Remove cancer types without ecDNA? GLM can correct for it but GSEA cannot.

RESULTS
	After removing noncoding genes, batch effect by center is reduced but not removed.

2025-02-14

Data at data/cloud/RodriguezFos2023
Analysis and figures at pedpancan/2025-03-12_NBL-survival.ipynb
# NBL-survival
For response to reviewers.
Is there any difference in survival between extra- and intrachromosomally amplified neuroblastomas?

## Validation
Note that we have 8 tumors in this dataset annotated as 'ecDNA (MYCN)' in the publication for which AC returns ecDNA- classifications:  
| Patient ID  | MYCN status | ecDNA (MYCN) | HSR (MYCN) |   amplicon_class | AC result |
|-------------|-------------|--------------|------------|------------------|-----------|
| CB2022      | amplified   |       yes    |     no | intrachromosomal | CNC at MYCN |
| CB2024      | amplified   |       yes    |     no | intrachromosomal | CNC, elsewhere |
| CB2031      | amplified   |       yes    |     no | no amplification | No amp, no genes |
| CB2042      | amplified   |       yes    |     no | no amplification | Invalid, no genes|
| CB2045      | amplified   |       yes    |     no | no amplification | No amp, no genes |
| NBL26       | amplified   |       yes    |     no | intrachromosomal | CNC at MYCN |
| NBL31       | amplified   |       yes    |     no | no amplification | No amp, no genes |
| NBL32       | amplified   |       yes    |     no | intrachromosomal | CNC at MYCN |

Going to tentatively use the AC classifications for consistency, but maybe bring it up with Elias and Anton.  

## Results
ecDNA has (barely) significantly worse outcomes than intrachromosomal amplification, both in the
Kaplan-Meier model (adjusted p = 0.042) and in the Cox model controlling for sex, age and amplification ONLY (p = 0.048). Including MYCN amplification as a covariate, using either the Rodriguez annotations or the AmpliconClassifier, renders the effect of ecDNA nonsignificant. Figures saved to `./out`.

## TODO
- Association test comparing incidence of ecDNA vs chromosomal amp for MYCN vs other loci?
- Follow up with Elias and Anton about discrepant ecDNA classifications.